# keywordKeyphraseExtraction フォルダ構成

keywordKeyphraseExtraction/
├── fetchFiveEventData.ts
├── keyphrase_method/
│ └── (空)
├── keyword-keyphrase-extractor.ts
├── keyword_method/
│ ├── keyword-extractor-library.ts
│ ├── textrank-library.ts
│ └── tf-idf-library.ts
├── policy.md
└── result/
├── keyword-extractor-library-result.md
├── textrank-library-result.md
└── tf-idf-library-result.md

## ファイルの説明

### keyword-keyphrase-extractor.ts

このファイルは、キーワードおよびキーフレーズ抽出処理全体のオーケストレーションを行うメインスクリプトです。主な機能は以下の通りです。

- **入力テキストの準備**: 抽出対象となるテキストデータ（イベントの説明文など）を準備します。現在はサンプルテキストが直接記述されていますが、将来的には `fetchFiveEventData.ts` などを通じて動的にデータを取得することを想定しているようです。
- **抽出アルゴリズムの呼び出し**: `keyword_method/` ディレクトリに配置された個別のキーワード抽出アルゴリズム（例: `tf-idf-library.ts`、`keyword-extractor-library.ts`）をインポートし、準備されたテキストデータに適用します。
- **結果の表示**: 抽出されたキーワードやキーフレーズをコンソールに出力します。
- **処理の実行とテスト**: スクリプトの末尾で定義されたメイン関数 `extractKeywordsAndKeyphrases` を実行し、一連の抽出処理を開始します。異なる抽出手法を試すためのテストベッドとしての役割も担っています。

### keyword_method/

このディレクトリには、具体的なキーワード抽出アルゴリズムを実装した TypeScript ファイルが格納されます。各ファイルは、特定の抽出手法（例: TF-IDF、TextRank、keyword-extractor ライブラリ利用など）に基づいたロジックを含みます。

ディレクトリ内の各ライブラリ (`.ts` ファイル) は、一般的に以下の共通インターフェースを持つ関数をエクスポートすることを想定しています。

- **入力**: 分析対象のテキスト（`string` 型）
- **出力**: 抽出されたキーワードの配列（`string[]` 型、または非同期処理の場合は `Promise<string[]>` 型）

これにより、`keyword-keyphrase-extractor.ts` から各手法を統一的に呼び出し、結果を比較検討することが容易になります。

現在含まれるファイルは以下の通りです。

- `keyword-extractor-library.ts`: `keyword-extractor` npm パッケージを利用したキーワード抽出処理。
- `textrank-library.ts`: (現在は空) TextRank アルゴリズムに基づくキーワード抽出処理を実装予定。
- `tf-idf-library.ts`: TF-IDF (Term Frequency-Inverse Document Frequency) に基づくキーワード抽出処理。日本語の形態素解析には `kuromoji.js` を使用。

### keyphrase_method/

このディレクトリには、具体的なキーセンテンス（キーフレーズ）抽出アルゴリズムを実装した TypeScript ファイルが格納されます。各ファイルは、特定の抽出手法に基づいたロジックを含みます。

ディレクトリ内の各ライブラリ (`.ts` ファイル) は、一般的に以下の共通インターフェースを持つ関数をエクスポートすることを想定しています。

- **入力**: 分析対象のテキスト（`string` 型）
- **出力**: 抽出されたキーセンテンスの配列（`string[]` 型、または非同期処理の場合は `Promise<string[]>` 型）

これにより、`keyword-keyphrase-extractor.ts` から各手法を統一的に呼び出し、結果を比較検討することが容易になります。

現在想定されるファイルは以下の通りです。

- `ts-textrank-keyphrase-library.ts`: (現在は空) `ts-textrank` ライブラリを利用したキーセンテンス抽出処理を実装予定。これは文単位の TextRank アルゴリズムを適用し、重要な文を抽出します。

## 手法評価結果と採用方針

### 評価結果 (2024 年実施)

複数のキーワード・キーフレーズ抽出手法を検証した結果、以下のような評価となりました：

**TextRank ライブラリ（キーフレーズ抽出）**

- ✅ **採用決定**: 講座の核心内容を適切に捉えている
- ✅ **内容の質**: ChatGPT 活用や実践的アプローチなど、重要な特徴を抽出
- ✅ **差別化**: 他講座との違いを明確に表現
- ⚠️ **改善点**: 文章の長さ調整、不完全文章の修正が必要

**他手法との比較**

- TF-IDF: 技術用語は抽出するが文脈が不足
- keyword-extractor: 単語レベルの抽出に留まる
- その他: TextRank が総合的に最も優秀

### 今後の開発方針

**ベース手法**: TextRank ライブラリによるキーフレーズ抽出を採用

**実装優先度**:

1. TextRank ライブラリの改良・最適化
2. キーフレーズの長さ制限機能追加
3. 他手法との組み合わせ検討（必要に応じて）

**品質向上計画**:

- 文章の短縮化処理の実装
- 技術キーワードの補完機能
- 不完全文章の検出・修正機能

## AI を活用した精度向上手法（検証予定）

### 検証予定のアプローチ

#### 🔄 **アプローチ 1: 後処理型 AI 精製**

```
テキスト → TextRank抽出 → AI精製 → 最終キーフレーズ
```

**概要**: TextRank で抽出した結果を AI で後処理・最適化

**検証項目**:

- 長い文章の短縮精度
- 不完全文章の補完品質
- 技術用語の抽出・補強効果
- 処理時間・コスト効率

**実装予定**:

```typescript
async function enhanceWithAI(textrankResults: string[]): Promise<KeyPhrase[]> {
  // TextRank結果をAIで精製
}
```

**検証結果**: [ ✅ 実装完了 - 2024 年 12 月実施 ]

**実装ファイル**: `keyphrase_method/textrank-library-with-ai-v5.ts`

**実装内容**:

- 前処理 AI: テキストクリーニングと構造最適化
- TextRank 処理: 既存アルゴリズムを活用
- 後処理 AI: キーフレーズ品質向上と短縮
- 段階別処理時間測定とパフォーマンス監視
- AI 有効/無効の切り替え機能

**テスト結果**:

- AI 有効版: 1019ms（API 呼び出し 2 回）
- AI 無効版: 627ms（TextRank のみ）
- kuromoji 形態素解析と PageRank アルゴリズム正常動作確認
- エラーハンドリングとフォールバック機能検証済み

**技術実装**:

- OpenAI API 対応（モック実装含む）
- 段階的処理フローの実装
- パフォーマンス計測機能
- 設定可能な AI・TextRank パラメータ

---

#### 🤖 **アプローチ 2: AI 主導型抽出**

```
テキスト → AI分析・抽出 → TextRank検証 → 最終キーフレーズ
```

**概要**: AI でキーフレーズを抽出し、TextRank で重要度スコアリング

**検証項目**:

- 文脈理解による抽出精度
- イベント推薦システム向け最適化
- TextRank との整合性
- レスポンス時間・安定性

**実装予定**:

```typescript
async function aiDrivenExtraction(text: string): Promise<ScoredKeyPhrase[]> {
  // AI主導でキーフレーズ抽出
}
```

**検証結果**: [ 未実施 ]

---

#### ⚖️ **アプローチ 3: ハイブリッド並列処理**

```
テキスト → [TextRank + AI] → スコア統合 → 最終キーフレーズ
```

**概要**: TextRank と AI を並列実行し、結果を統合

**検証項目**:

- 両手法の長所活用効果
- スコア統合アルゴリズムの精度
- 重複排除・優先度付けの品質
- 総合的な信頼性向上

**実装予定**:

```typescript
async function hybridExtraction(text: string): Promise<HybridResult> {
  // TextRankとAIの並列処理・統合
}
```

**検証結果**: [ 未実施 ]

---

#### 🎯 **アプローチ 4: 段階的 AI 強化**

```
テキスト → 前処理AI → TextRank → 後処理AI → 最終キーフレーズ
```

**概要**: 複数段階で AI を活用し、段階的に精度向上

**検証項目**:

- 前処理による TextRank 精度向上
- 後処理による最終品質向上
- 段階別の効果測定
- 全体的なパフォーマンス

**実装予定**:

```typescript
async function stagedAIEnhancement(text: string): Promise<EnhancedResult> {
  // 多段階AI処理
}
```

**検証結果**: [ 未実施 ]

---

#### 📝 **アプローチ 5: AI サマリー前処理型**

```
テキスト → AI要約 → TextRank抽出 → 最終キーフレーズ
```

**概要**: 長いテキストを AI で要約してから TextRank でキーフレーズ抽出

**検証項目**:

- 長文の重要情報濃縮効果
- ノイズ除去による抽出精度向上
- 要約品質とキーフレーズ精度の相関
- 処理時間短縮効果

**期待される効果**:

- 冗長な説明文から核心部分のみを抽出
- TextRank がより重要な情報に集中できる
- 講師紹介や詳細説明などのノイズ除去
- 全体的な処理速度向上の可能性

**実装予定**:

```typescript
async function aiSummaryToTextRank(text: string): Promise<KeyPhrase[]> {
  // Step 1: AI要約
  const summary = await summarizeWithAI(text, {
    maxLength: 200, // 元の1/3程度に圧縮
    focus: ["学習内容", "技術要素", "対象者", "特徴"],
    removeNoise: ["講師紹介", "会社情報", "申込方法"],
  });

  // Step 2: TextRank抽出
  const keyphrases = await textrankKeyphraseExtractor(summary);

  return keyphrases;
}

async function summarizeWithAI(
  text: string,
  options: SummaryOptions
): Promise<string> {
  const prompt = `
  以下のイベント説明文を、キーフレーズ抽出に最適な形で要約してください：
  
  要約条件：
  - 最大${options.maxLength}文字以内
  - 重視する要素: ${options.focus.join(", ")}
  - 除外する要素: ${options.removeNoise.join(", ")}
  - 技術用語は正確に保持
  - 学習目標・対象者・手法を明確に
  
  元テキスト: ${text}
  `;

  return await callAIAPI(prompt);
}
```

**検証結果**: [ 未実施 ]

**特別な検証ポイント**:

- 要約による情報損失の許容範囲
- 要約長とキーフレーズ品質のトレードオフ
- 要約スタイル（箇条書き vs 文章）の比較
- 複数の要約手法（抽象要約 vs 抽出要約）の検証

### 検証計画と実装優先度

#### **Phase 1: 後処理型 AI 精製（最優先）**

- **期間**: 1-2 週間
- **理由**: 既存実装の活用、低リスク、即効性
- **検証内容**: GPT-3.5-turbo による基本的な精製機能
- **成功基準**: 文章短縮率 80%以上、技術用語抽出率向上

#### **Phase 2: AI サマリー前処理型（高優先）**

- **期間**: 1-2 週間
- **理由**: 長文対応、ノイズ除去、処理効率化の期待
- **検証内容**: 要約最適化と TextRank 組み合わせ効果
- **成功基準**: 長文(1000 文字以上)で従来比 30%精度向上

#### **Phase 3: カテゴリ分類機能追加**

- **期間**: 1 週間
- **理由**: イベント推薦システムとの親和性向上
- **検証内容**: 技術要素、学習内容、対象者レベル等の分類
- **成功基準**: 分類精度 85%以上

#### **Phase 4: AI 主導型抽出検証**

- **期間**: 2-3 週間
- **理由**: より高精度な抽出手法の検証
- **検証内容**: GPT-4 による高精度抽出と TextRank 検証
- **成功基準**: Phase 1-2 比で精度 20%向上

#### **Phase 5: ハイブリッド手法検証**

- **期間**: 3-4 週間
- **理由**: 最高精度の実現、複数手法の統合検証
- **検証内容**: 並列処理・統合アルゴリズムの開発
- **成功基準**: 単独手法比で総合精度 30%向上

### コスト・パフォーマンス考慮事項

#### **軽量版設定（開発開始時）**

- AI: OpenAI GPT-3.5-turbo
- 処理: バッチ処理（複数イベント同時）
- キャッシュ: Redis 等による結果キャッシュ
- 予算: 月額$50-100 程度を想定

#### **高精度版設定（本格運用時）**

- AI: GPT-4 or Claude-3
- 処理: リアルタイム処理対応
- 最適化: ファインチューニング検討
- 予算: 月額$200-500 程度を想定

### 検証評価基準

#### **定量評価**

- キーフレーズ長さ（目標: 20 文字以内）
- 技術用語カバー率（目標: 80%以上）
- 処理時間（目標: 5 秒以内/イベント）
- コスト効率（目標: $0.01 以下/イベント）

#### **定性評価**

- イベント推薦システムでの実用性
- ユーザー体験への影響
- 開発・運用の持続可能性
- 将来拡張性

#### **AI サマリー特有の評価項目**

- 要約品質（情報保持率、可読性）
- 要約後の TextRank 精度向上率
- 長文処理における効率性
- 要約による情報損失の許容範囲

## 実行コマンド

- やりたい手法をコメントアウト
- 次のコマンドを実行

```
 npx ts-node src/utils/keywordKeyphraseExtraction/keyword-keyphrase-extractor.ts
```

## 実行結果報告

### 概要

AI サマリー前処理型アプローチを 5 つ目の手法として追加し、検証計画を更新しました。

### 実行ステップ

1. 「アプローチ 5: AI サマリー前処理型」を新規追加
2. 詳細な実装予定コードとインターフェース設計
3. Phase 2 として高優先度に位置付け
4. AI サマリー特有の評価項目を追加

### 最終成果物

- 長文対応に特化した AI+TextRank ハイブリッド手法の企画
- 要約品質とキーフレーズ精度の相関検証計画
- ノイズ除去による精度向上期待の文書化
- 段階的検証における優先度調整

### 注意点・改善提案

- **要約による情報損失**の許容範囲を慎重に検証
- **要約スタイル**（箇条書き vs 文章）の比較検証を推奨
- **長文イベント**での効果測定を重点的に実施
- Phase 1 と 2 を並行実施して効果比較することを検討

この手法は特に長い説明文のイベントで威力を発揮しそうですね！要約で重要部分だけを抽出してから TextRank に通すことで、より精度の高いキーフレーズが期待できます。

```

```
